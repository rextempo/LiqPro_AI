# LiqPro项目开发任务清单

## 阶段一：项目初始化与基础架构搭建

### 任务1.1：项目骨架搭建 ✅
- [x] 创建项目根目录结构
  - backend/
  - frontend/
  - shared/
  - config/
  - scripts/
  - docker/
  - docs/
- [x] 初始化Git仓库
  - 配置.gitignore
  - 设置Git hooks
- [x] 配置pnpm workspace
  - 创建pnpm-workspace.yaml
  - 设置workspace依赖关系
- [x] 设置根目录配置文件
  - package.json（工作区配置）
  - tsconfig.json（TypeScript基础配置）
- [x] 创建Docker配置
  - Dockerfile（多阶段构建）
  - docker-compose.yml（开发环境配置）
  - .dockerignore

### 任务1.2：共享模块开发 ✅
- [x] 创建shared/src/types目录
  - [x] agent.ts
    - [x] Agent接口定义
    - [x] Agent状态枚举
    - [x] Agent配置类型
  - [x] pool.ts
    - [x] Pool接口定义
    - [x] 流动性分布类型
    - [x] 收益率计算类型
  - [x] api.ts
    - [x] 请求/响应基础接口
    - [x] API错误类型
    - [x] 分页类型定义

- [x] 创建shared/src/constants目录
  - [x] errorCodes.ts
    - [x] API错误码
    - [x] 业务错误码
    - [x] 系统错误码
  - [x] poolTypes.ts
    - [x] 池子类型枚举
    - [x] 风险等级定义
    - [x] 状态常量

- [x] 创建shared/src/utils目录
  - [x] math.ts
    - [x] APY计算函数
    - [x] 价格计算工具
    - [x] 风险评估函数
  - [x] validation.ts
    - [x] 地址验证
    - [x] 金额验证
    - [x] 配置验证

### 任务1.3：环境配置 ✅
- [x] 创建配置文件
  - [x] config/default.js
  - [x] config/development.js
  - [x] config/production.js
  - [x] config/test.js
- [x] 环境变量模板
  - [x] .env.example
  - [x] 开发环境变量说明
  - [x] 生产环境变量说明
- [x] 配置加载逻辑
  - [x] 环境判断
  - [x] 配置合并
  - [x] 敏感信息处理

## 阶段二：后端核心模块开发

### 任务2.1：后端基础设置 ✅
- [x] Express应用初始化
  - [x] 应用实例创建
  - [x] 路由中间件配置
  - [x] 错误处理中间件
- [x] 中间件配置
  - [x] CORS设置
  - [x] body-parser配置
  - [x] compression启用
  - [x] 安全中间件
- [x] 错误处理机制
  - [x] 错误类型定义
  - [x] 错误捕获中间件
  - [x] 错误响应格式化
- [x] 日志系统
  - [x] Winston配置
  - [x] 日志分级
  - [x] 日志持久化

### 任务2.2：数据与监控模块
- [x] Meteora SDK集成
  - [x] 在`backend/src/services/meteora.ts`中封装Meteora DLMM SDK
  - [x] 实现`getAllPools()`方法获取所有池子基础数据
  - [x] 实现`getPoolDetail(address: string)`方法获取单个池子详细数据
  - [x] 处理API错误和限流情况，实现请求队列和重试机制

- [x] 数据获取与筛选
  - [x] 在`backend/src/core/data/pool-service.ts`中实现`getTop100Pools()`方法
  - [x] 实现池子筛选逻辑（TVL > 10,000美元且成交量 > 20,000美元）
  - [x] 实现按成交量降序排序
  - [x] 配置5分钟定时更新机制

- [x] 缓存机制
  - [x] 在`backend/src/utils/cache.ts`中实现内存缓存系统
  - [x] 配置Top 100池子列表缓存（5分钟）
  - [x] 配置池子详情数据缓存（5分钟）
  - [x] 实现缓存失效和刷新机制

- [x] Agent持仓监控
  - [x] 在`backend/src/core/data/position-monitor.ts`中实现监控系统
  - [x] 实现`getAgentPositions()`获取持仓池子地址
  - [x] 实现`monitorPositionPools()`获取池子详细数据
  - [x] 实现数据对比和变化检测逻辑

- [x] 数据规范化
  - [x] 在`shared/src/types/pool.ts`中定义标准化数据接口
  - [x] 扩展现有的`Pool`和相关接口
  - [x] 新增`PoolDetail`接口定义
  - [ ] 在`backend/src/db/models/`下实现数据库模型
  - [x] 在`backend/src/core/data/transformers.ts`中实现数据转换函数

- [x] 任务调度
  - [x] 在`backend/src/core/data/scheduler.ts`中实现调度器
  - [x] 配置Top 100池子列表更新任务（5分钟）
  - [x] 配置Agent持仓监控任务（5分钟）
  - [x] 实现错误处理和日志记录

- [x] API端点
  - [x] 在`backend/src/api/pools`目录下实现接口
  - [x] 实现`GET /api/pools/recommended`接口
  - [x] 实现`GET /api/pools/:address`接口
  - [x] 实现`GET /api/pools/monitored`接口

- [x] 内部接口
  - [x] 在`backend/src/core/data/index.ts`中导出接口
  - [x] 实现`getPoolsByAPR()`接口
  - [x] 实现`getPoolsByVolume()`接口
  - [x] 实现`getPoolDetail()`接口
  - [x] 实现`subscribeToPoolChange()`接口

- [x] 技术规范
  - [x] 实现TypeScript类型系统
  - [x] 符合项目结构，遵循项目命名规范
  - [x] 实现错误处理和日志记录
  - [x] 优化内存缓存使用
  - [x] 配置参数管理

- [x] 大户流动性监控
  - [x] 定期轮询关键池子数据（5分钟）
  - [x] 基于WebHook的事件监听
  - [x] 大户识别策略实现
  - [x] 流动性变化分析

- [ ] 🔄 监控配置接口 (延迟到MVP后实现)
  - [ ] 轮询间隔配置
  - [ ] 大户阈值配置
  - [ ] 风险等级阈值配置

- [ ] 🔄 通知机制增强 (部分延迟实现)
  - [x] 基础日志记录
  - [x] 系统事件触发
  - [ ] WebSocket实时推送
  - [ ] 邮件通知系统

- [ ] 🔄 错误处理增强 (部分延迟实现)
  - [x] 基本错误捕获
  - [x] 错误日志记录
  - [ ] 自定义错误类型
  - [ ] 错误恢复机制

### 任务2.3：数据库设计
#### 2.3.1 表结构设计 ✅
- [x] Users 表设计与实现
  - [x] 设计表结构（id, wallet_address, nonce 等字段）
  - [x] 创建表创建脚本
  - [x] 定义主键和唯一约束
  - [x] 实现索引优化：wallet_address 索引
- [x] Agents 表设计与实现
  - [x] 设计表结构（id, user_id, name, status 等基础字段）
  - [x] 添加策略相关字段（strategy, strategy_params）
  - [x] 添加资金管理字段（deposit_amount, current_value 等）
  - [x] 定义主键、外键约束和检查约束
  - [x] 实现索引优化：user_id, status, available_balance 索引
- [x] Pools 表设计与实现
  - [x] 设计基础结构（address, name, token_x/y 相关字段）
  - [x] 添加池子参数字段（bin_step, base_fee, max_fee 等）
  - [x] 添加数据指标字段（current_price, total_liquidity 等）
  - [x] 添加分析指标字段（fees_tvl_ratio, apr, activity_score 等）
  - [x] 添加价格数据和信号评级字段
  - [x] 实现索引优化：tvl, apr, tier, score 等索引
- [x] Positions 表设计与实现
  - [x] 设计基础结构（id, agent_id, pool_address 等）
  - [x] 添加仓位参数和资金状态字段
  - [x] 添加投资策略和健康度评估字段
  - [x] 定义主键、外键约束
  - [x] 实现索引优化：agent_id, pool_address, health_score 等
- [x] AgentLogs 表设计与实现
  - [x] 设计表结构（id, agent_id, action_type, status 等）
  - [x] 添加操作详情字段（details, tx_signature 等）
  - [x] 实现索引优化：agent_time 复合索引等
- [x] WhaleActivities 表设计与实现
  - [x] 设计表结构和活动指标字段
  - [x] 添加影响评估字段
  - [x] 实现索引优化：pool_time 复合索引等
- [x] StrategyDecisions 表设计与实现
  - [x] 设计表结构和决策上下文字段
  - [x] 添加执行状态字段
  - [x] 实现索引优化：agent_id, decision_type 等
- [x] 数据完整性约束
  - [x] 添加数值范围检查
  - [x] 添加复合约束
  - [x] 添加枚举值检查
  - [x] 添加分数范围检查
- [x] 性能优化
  - [x] 添加复合索引
  - [x] 添加排序索引
  - [x] 预留表空间管理选项
- [x] 维护性改进
  - [x] 添加中文表注释
  - [x] 添加时间戳更新触发器
  - [x] 添加扩展支持

#### 2.3.2 数据库迁移 ✅
- [x] 初始迁移脚本开发
  - [x] 创建数据库初始化脚本
  - [x] 开发表创建脚本
  - [x] 实现主键、外键和约束设置
  - [x] 添加索引创建命令
- [x] 回滚脚本开发
  - [x] 为每个表创建回滚脚本
  - [x] 实现按依赖顺序的表删除逻辑
- [x] 种子数据准备
  - [x] 开发测试环境基础种子数据
  - [x] 创建测试用户和示例数据

#### 2.3.3 数据模型
- [x] 用户和代理模型开发
  - [x] 实现 User 和 Agent 模型定义
  - [x] 设置字段类型和验证规则
  - [x] 实现关系和模型方法
- [x] 池子模型开发
  - [x] 实现 Pool 模型定义
  - [x] 开发评分和分析方法
  - [x] 实现 tier 层级判定逻辑
- [x] 仓位模型开发
  - [x] 实现 Position 模型定义
  - [x] 开发健康度评估方法
  - [x] 实现收益计算方法
- [ ] 日志和决策模型开发
  - [ ] 实现各类日志和决策模型
  - [ ] 建立模型关联关系
- [ ] JSON 数据模型设计
  - [ ] 设计各类 JSON 结构
  - [ ] 开发数据验证方法

#### 2.3.6 数据库连接配置
- [ ] 数据库连接文件开发
  - [ ] 创建 `src/db/index.ts`
  - [ ] 实现数据库连接配置
  - [ ] 添加连接池设置
  - [ ] 实现错误处理机制
- [ ] 数据源配置文件开发
  - [ ] 创建 `src/db/data-source.ts`
  - [ ] 配置实体加载
  - [ ] 配置迁移设置
  - [ ] 实现环境变量集成
- [ ] 模型索引文件开发
  - [ ] 创建 `src/db/models/index.ts`
  - [ ] 导出所有模型
  - [ ] 实现模型关系映射
  - [ ] 添加类型导出

#### 2.3.4 数据访问层
- [ ] 用户和代理存储库开发
  - 实现基础 CRUD 方法
  - 开发统计和评估查询
  - 优化常用查询
- [ ] 池子数据存储库开发
  - 实现分层和评分查询
  - 开发分析和筛选方法
  - 优化性能关键查询
- [ ] 仓位存储库开发
  - 实现健康度和分析查询
  - 开发收益统计方法
  - 优化常用查询场景
- [ ] 日志和决策存储库开发
  - 实现历史记录查询
  - 开发决策跟踪方法
- [ ] 查询优化和事务处理
  - 实现缓存策略
  - 开发事务管理框架
  - 实现数据一致性工具

#### 2.3.5 测试和文档
- [ ] 数据库测试开发
  - 创建表结构单元测试
  - 开发模型验证测试
  - 实现性能基准测试
- [ ] 数据库文档编写
  - 编写表结构文档
  - 创建模型关系图
  - 编写查询示例文档

### 任务2.4：认证系统
- [ ] 钱包认证
  - [ ] 连接钱包
    - [ ] Phantom集成
    - [ ] 签名验证
  - [ ] 会话管理
    - [ ] JWT生成
    - [ ] 会话验证

- [ ] 访问控制
  - [ ] 资源权限
    - [ ] Agent所有权检查
    - [ ] 钱包地址验证

## 阶段三：信号与Agent执行模块

### 任务3.1：信号与风控
- [ ] 排序算法
  - 收益率排序
  - 风险评估
  - 综合评分
- [ ] 投资推荐
  - T1策略实现
  - T2策略实现
  - T3策略实现
- [ ] 风险评估
  - 仓位评估
  - 市场风险分析
  - 流动性风险计算
- [ ] 警报机制
  - 风险预警
  - 阈值设置
  - 通知发送

### 任务3.2：Agent执行
- [ ] Solana集成
  - 钱包管理
  - 交易签名
  - RPC调用
- [ ] 资金管理
  - 余额检查
  - 资金分配
  - 限额控制
- [ ] LP操作
  - 添加流动性
  - 移除流动性
  - 仓位调整
- [ ] 代币兑换
  - 最优路径
  - 滑点控制
  - 失败处理
- [ ] 状态跟踪
  - 状态更新
  - 日志记录
  - 异常处理
- [ ] 收益计算
  - 实时收益
  - 历史收益
  - 费用计算

### 任务3.3：API完善
- [ ] Agents API
  - CRUD接口
  - 状态查询
  - 操作接口
- [ ] Pools API
  - 列表查询
  - 详情获取
  - 数据统计
- [ ] Positions API
  - 仓位查询
  - 历史记录
  - 收益统计

## 阶段四：前端基础开发

### 任务4.1：前端设置
- [ ] React初始化
  - 项目创建
  - 依赖安装
  - 基础配置
- [ ] 路由系统
  - 路由定义
  - 导航守卫
  - 路由懒加载
- [ ] UI配置
  - Tailwind设置
  - 主题配置
  - 响应式设计
- [ ] 组件库
  - shadcn/ui集成
  - 自定义主题
  - 组件封装
- [ ] 布局组件
  - 主布局
  - 导航栏
  - 侧边栏

### 任务4.2：认证UI
- [ ] 登录页面
  - 表单设计
  - 验证逻辑
  - 错误处理
- [ ] 注册页面
  - 表单组件
  - 数据验证
  - 提交处理
- [ ] 认证上下文
  - 状态管理
  - Token处理
  - 用户信息
- [ ] API服务
  - 认证请求
  - 响应处理
  - 错误处理

### 任务4.3：API通信
- [ ] API客户端
  - 请求配置
  - 响应处理
  - 错误处理
- [ ] 请求拦截
  - Token注入
  - 请求转换
  - 重试机制
- [ ] 响应拦截
  - 错误处理
  - 响应转换
  - 刷新Token
- [ ] API Hooks
  - 查询Hook
  - 变更Hook
  - 缓存策略

## 阶段五：前端功能实现

### 任务5.1：Dashboard
- [ ] 资产总览
  - 资产统计
  - 图表展示
  - 实时更新
- [ ] Agent列表
  - 列表视图
  - 状态显示
  - 快捷操作
- [ ] Agent表单
  - 创建流程
  - 配置选项
  - 验证规则
- [ ] 数据可视化
  - 收益图表
  - 分布图表
  - 趋势分析

### 任务5.2：Agent详情
- [ ] 状态显示
  - 基本信息
  - 运行状态
  - 实时更新
- [ ] 资金操作
  - 注入界面
  - 提取界面
  - 确认流程
- [ ] 仓位管理
  - 仓位列表
  - 健康度显示
  - 调整功能
- [ ] 收益统计
  - 收益图表
  - 历史记录
  - 导出功能
- [ ] 操作日志
  - 日志列表
  - 筛选功能
  - 详情查看

### 任务5.3：池子推荐
- [ ] 推荐展示
  - 列表视图
  - 排序功能
  - 筛选选项
- [ ] 详情卡片
  - 基本信息
  - 数据指标
  - 操作按钮
- [ ] LP操作
  - 添加界面
  - 移除界面
  - 确认流程
- [ ] 数据可视化
  - TVL图表
  - APY趋势
  - 分布图表

### 任务5.4：智能辅助
- [ ] 思考过程
  - 决策展示
  - 逻辑说明
  - 实时更新
- [ ] 市场分析
  - 趋势提示
  - 风险提示
  - 建议生成
- [ ] 风控通知
  - 警告展示
  - 级别区分
  - 处理建议

## 阶段六：测试与优化

### 任务6.1：单元测试
- [ ] 后端测试
  - 服务测试
  - 工具测试
  - 模型测试
- [ ] 前端测试
  - 组件测试
  - Hook测试
  - 工具测试
- [ ] API测试
  - 接口测试
  - 参数验证
  - 响应验证

### 任务6.2：集成测试
- [ ] E2E测试
  - 流程测试
  - 场景测试
  - 回归测试
- [ ] 自动化
  - CI配置
  - 测试脚本
  - 报告生成
- [ ] 测试数据
  - 数据生成
  - 数据清理
  - 环境隔离

### 任务6.3：性能优化
- [ ] API优化
  - 响应时间
  - 并发处理
  - 缓存策略
- [ ] 前端优化
  - 代码分割
  - 懒加载
  - 缓存优化
- [ ] 资源优化
  - 按需加载
  - 资源压缩
  - CDN配置
- [ ] 缓存策略
  - 客户端缓存
  - 服务端缓存
  - 分布式缓存

### 任务6.4：部署准备
- [ ] Docker优化
  - 镜像优化
  - 多阶段构建
  - 容器配置
- [ ] CI/CD
  - 工作流配置
  - 部署脚本
  - 回滚机制
- [ ] 部署文档
  - 环境要求
  - 部署步骤
  - 故障处理
- [ ] 环境管理
  - 变量配置
  - 密钥管理
  - 环境隔离

## 阶段七：文档与上线

### 任务7.1：开发文档
- [ ] API文档
  - 接口说明
  - 参数说明
  - 示例代码
- [ ] 代码规范
  - 编码规范
  - 提交规范
  - 审查规范
- [ ] 项目文档
  - README更新
  - 贡献指南
  - 架构说明

### 任务7.2：用户文档
- [ ] 使用指南
  - 功能说明
  - 操作流程
  - 最佳实践
- [ ] FAQ
  - 常见问题
  - 故障排除
  - 使用技巧
- [ ] 特性说明
  - 功能介绍
  - 版本特性
  - 更新说明

### 任务7.3：上线准备
- [ ] 安全审计
  - 代码审查
  - 漏洞扫描
  - 安全测试
- [ ] 验收测试
  - 功能验收
  - 性能验收
  - 安全验收
- [ ] 上线清单
  - 检查项目
  - 风险评估
  - 回滚计划
- [ ] 生产部署
  - 环境准备
  - 数据迁移
  - 监控配置 