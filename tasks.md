# LiqPro 开发任务规划

## 项目技术栈确认

### 基础环境

- Solana: mainnet
- RPC节点: ✅ 已确认可用
- 前端框架: React
- 数据库: PostgreSQL
- 监控系统: Prometheus + Grafana + ELK Stack

### 集成确认

- Meteora DLMM SDK: ✅ 已获得访问权限和文档
- Jupiter API: ✅ 已获得访问密钥
- 钱包支持: 仅 Solana 原生钱包
- 交易要求: 单笔交易，延迟不超过3秒

### 安全要求

- 密钥管理:
  - 禁止明文传输/存储
  - 需要实现用户和系统级别的权限管理
  - 必须实现安全的密钥存储和传输机制

### 架构设计规范

- 部署架构：

  - 前端：React SPA，CDN/静态服务部署
  - 后端：Node.js微服务架构
  - 数据库：PostgreSQL 12.0+（推荐AWS RDS）
  - 初期：单机部署，预留扩展接口
  - 扩展：DAU>500后迁移至集群架构

- 服务组织：
  - MVP阶段：前端直接调用后端服务
  - 二期规划：引入API网关层
  - 容器化：使用Docker + Docker Compose
  - CI/CD：GitHub Actions/GitLab CI

### UI/UX规范

- 设计风格：Notion风格
- 组件库：Tailwind UI/Shadcn UI
- 数据更新频率：
  - 关键数据：30秒/次
  - 实时日志：WebSocket推送
  - 其他数据：2-5分钟/次
- 设备适配：优先PC端，特别是Mac

### 数据存储规范

- 数据分层：
  - 热数据：30天内数据
  - 冷数据：30天以上历史数据
- 分库分表：
  - MVP阶段：单库模式
  - 扩展期：用户数>10,000后按用户ID分表
- 备份策略：
  - 使用云存储（S3/Cloud Storage）
  - 跨区域备份机制

## 详细需求规范

### 状态机规范

- 基础状态：运行、等待、停止
- 扩展状态：
  - 初始化：Agent创建后资金到位但未建仓
  - 部分减仓：风险达到中等阈值触发部分减仓
  - 紧急退出：用户触发或严重风险触发全面退出
- 状态转换触发条件：
  - Running → Waiting：可用SOL低于0.1
  - Waiting → Running：余额超过1 SOL
  - Running → 部分减仓：健康评分2.0-2.5持续10分钟
  - 任何状态 → 紧急退出：健康评分低于1.5持续5分钟或用户手动触发

### 资金安全规范

- 交易限额：
  - 单笔上限：用户总资产30%或50 SOL（取小值）
  - 日交易限额：不超过总资产70%
- 多重签名：
  - MVP阶段：实现交易前确认和结果验证的双重检查
  - 预留多重签名钱包集成接口

### 监控指标规范

- 关键指标：
  - LP池子健康度变化率（>20%/小时告警）
  - 交易滑点（>预期1.5倍告警）
  - 大户LP移除（>10%或主要池子同时移除）
  - 代币价格波动（30分钟内>15%）
  - Agent操作空闲时间监控
- 告警级别：
  - 信息：UI显示
  - 警告：UI+邮件
  - 严重/紧急：UI+邮件+短信/Telegram

### 数据备份规范

- 备份频率：
  - 交易数据：实时备份
  - 配置数据：变更即备份
  - 系统状态：5分钟增量，每日全量
- 数据保留：
  - 交易记录：永久
  - 详细日志：90天
  - 系统数据：1年以上
- 跨区域备份要求：至少一个跨区域备份

### 性能指标规范

- 并发要求：
  - MVP阶段：支持500并发用户
  - 目标扩展：2000-5000用户
- 交易处理：
  - 常规：10-20 TPS
  - 峰值：能应对市场波动时的并发
- 响应时间：
  - 交易延迟：<3秒
  - UI响应：<1秒

### 错误处理规范

- 重试机制：
  - 3次重试（间隔：5s、15s、30s）
  - 每次重试可调整滑点容忍度（5%-10%）
- 网络波动处理：
  - 至少3个备用RPC节点
  - 自动节点切换机制
  - 非紧急交易自动暂停
- 手动恢复机制：
  - 交易重试功能
  - 状态回滚能力
  - 紧急操作接口

### 测试要求规范

- 环境要求：
  - 完整测试网环境
  - 主网数据回放能力
  - 模拟交易生成器
- 压测指标：
  - 200 Agent并发操作
  - 市场波动模拟
  - 7天无人值守测试

## 阶段一：基础设施搭建（2周）

### 1.1 项目初始化（3天）

- ✅ 创建项目基础结构
  ```
  /LiqPro
  ├── services/                # 微服务模块
  │   ├── data-service/       # 数据采集和处理服务
  │   ├── signal-service/     # 信号生成和分析服务
  │   ├── scoring-service/    # 评分和决策服务
  │   └── agent-engine/       # Agent执行引擎
  ├── libs/                   # 共享库
  ├── frontend/              # 前端应用
  ├── deploy/                # 部署配置
  └── docs/                  # 项目文档
  ```
- ✅ 配置开发环境
  - ✅ 设置Docker开发环境
  - ✅ 配置ESLint和Prettier
  - ✅ 设置Git工作流和提交规范
  - ✅ 配置CI/CD基础管道

### 1.2 数据层设计（4天）

- ✅ PostgreSQL设计和实现

  - ✅ 创建基本表结构（agents和transactions）
  - ✅ 实现基本索引（用户ID、状态、健康分数等）
  - ✅ 创建分区表结构
    - ✅ 按时间范围分区transactions表
    - ✅ 设置分区维护策略
  - ✅ 设置数据备份策略
    - ✅ 配置WAL归档
    - ✅ 实现定时备份脚本
    - ✅ 设置跨区域备份

- ✅ MongoDB配置和优化

  - ✅ 完成基础连接配置
  - ✅ 配置分片策略
    - ✅ 设置分片键（agentId）
    - ✅ 配置chunk大小
  - ✅ 创建索引结构
    - ✅ 创建复合索引
    - ✅ 设置TTL索引
  - ✅ 实现数据生命周期管理
    - ✅ 配置数据过期策略
    - ✅ 实现数据归档流程

- ✅ Redis缓存层实现
  - ✅ 完成基础连接配置
  - ✅ 配置内存管理策略
    - ✅ 设置maxmemory策略
    - ✅ 配置内存警告阈值
  - ✅ 设置持久化策略
    - ✅ 配置RDB快照
    - ✅ 设置AOF持久化
  - ✅ 实现数据过期策略
    - ✅ 设置缓存TTL
    - ✅ 实现LRU淘汰机制

### 1.3 安全基础设施（3天）

- ✅ 实现认证系统
  - ✅ JWT认证实现
  - ✅ 刷新令牌机制
  - ✅ API限流实现
- ✅ 加密系统实现
  - ✅ 密钥分片存储
  - ✅ 数据加密实现
  - ✅ 安全传输层配置

### 1.4 监控系统搭建（4天）

- ✅ Prometheus + Grafana设置
  - ✅ 配置系统指标采集
  - ✅ 设置业务指标监控
  - ✅ 创建告警规则
  - ✅ 配置自动扩展触发器
- ✅ ELK日志系统实现
  - ✅ 配置日志收集器
  - ✅ 设置索引策略
  - ✅ 实现日志轮转
  - ✅ 创建监控仪表板

## 阶段二：核心服务开发（3周）

### 2.1 数据服务开发（5天）

- ✅ 数据采集模块
  - ✅ Meteora池子数据采集接口
  - ✅ 市场价格数据获取
  - ✅ 池子事件监听器
  - ✅ 大户流动性监控
- ✅ 数据处理模块
  - ✅ 市场数据聚合器
  - ✅ 数据标准化处理
  - ✅ 实时数据流管理
  - ✅ 历史数据压缩存储
- ✅ 数据存储优化
  - ✅ 实现数据分层策略
  - ✅ 优化冷热数据访问
  - ✅ 数据索引优化

### 2.2 信号服务开发（5天）

- ✅ 市场分析模块
  - ✅ 价格趋势分析
  - ✅ 流动性分布分析
  - ✅ 交易量分析
  - ✅ 相关池子关联分析
- ✅ 策略生成系统
  - ✅ 实现基础策略模板
  - ✅ 策略参数自动调整
  - ✅ 策略组合与权重分配
- ✅ 回测系统
  - ✅ 历史数据回放机制
  - ✅ 策略性能评估
  - ✅ 参数优化算法

### 2.3 评分服务开发（5天）

- [ ] 健康度评分系统
  - [ ] 实现基础性能评分
  - [ ] 流动性分布评分
  - [ ] 费用效率评分
  - [ ] 稳定性评分计算
- [ ] 风险评估模块
  - [ ] 价格风险监控
  - [ ] 流动性风险分析
  - [ ] 大户行为监控
  - [ ] 综合风险评分
- [ ] 决策建议生成
  - [ ] 基于评分的行动建议
  - [ ] 资金配置优化建议
  - [ ] 风险预警机制

### 2.4 Agent引擎开发（6天）

- [ ] 状态机实现
  - [ ] 基础状态管理
  - [ ] 状态转换规则实现
  - [ ] 状态持久化机制
  - [ ] 状态事件触发器
- [ ] 交易执行系统
  - [ ] 交易请求构建
  - [ ] 交易签名管理
  - [ ] 交易发送与确认
  - [ ] 失败交易重试机制
- [ ] 资金管理模块
  - [ ] 用户资金跟踪
  - [ ] 交易限额控制
  - [ ] 收益计算与统计
  - [ ] 资金安全保障措施
- [ ] 风控系统
  - [ ] 实现紧急退出机制
  - [ ] 部分减仓逻辑
  - [ ] 风险阈值监控
  - [ ] 自动风险应对

### 2.5 巡航模块开发（5天）
- [ ] 自动运行机制
  - [ ] 定时任务调度器
  - [ ] 自动化操作流程
  - [ ] 异常情况处理
- [ ] 仓位维护功能
  - [ ] 仓位健康检查
  - [ ] 自动调整算法
  - [ ] 最优仓位计算
- [ ] 与风控模块协调
  - [ ] 风险监测集成
  - [ ] 风控策略适应
  - [ ] 应急措施联动

## 阶段三：前端开发（2周）

### 3.1 基础框架搭建（3天）

- [ ] 前端项目初始化
  - [ ] React项目配置
  - [ ] 路由系统设置
  - [ ] 状态管理实现
  - [ ] API客户端配置
- [ ] UI组件库开发
  - [ ] 实现基础组件
  - [ ] 设计主题系统
  - [ ] 响应式布局支持

### 3.2 核心功能实现（8天）

- [ ] Dashboard开发
  - [ ] 概览页面实现
  - [ ] 性能指标展示
  - [ ] 实时数据更新
  - [ ] 图表可视化
- [ ] Agent管理界面
  - [ ] Agent创建流程
  - [ ] 状态监控与控制
  - [ ] 历史操作记录
  - [ ] 资金管理界面
- [ ] 监控页面
  - [ ] 风险监控面板
  - [ ] 告警配置界面
  - [ ] 实时日志查看
  - [ ] 系统状态展示
- [ ] 设置界面
  - [ ] 用户偏好设置
  - [ ] 风险参数配置
  - [ ] 通知设置
  - [ ] API密钥管理

### 3.3 性能优化（3天）

- [ ] 前端性能优化
  - [ ] 代码分割实现
  - [ ] 缓存策略优化
  - [ ] 首屏加载优化
  - [ ] 实时数据更新优化
- [ ] 用户体验改进
  - [ ] 加载状态处理
  - [ ] 错误提示优化
  - [ ] 表单验证增强
  - [ ] 交互流程简化

## 阶段四：集成测试和部署（1周）

### 4.1 集成测试（3天）

- ✅ 服务间集成测试
  - ✅ API接口测试
  - ✅ 数据一致性测试
  - ✅ 状态同步测试
- [ ] 端到端测试
  - [ ] 用户流程测试
  - [ ] 错误恢复测试
  - [ ] 边界条件测试
- [ ] 性能压力测试
  - [ ] 并发用户测试
  - [ ] 数据库性能测试
  - [ ] 网络延迟测试
- [ ] 安全漏洞测试
  - [ ] API安全测试
  - [ ] 认证授权测试
  - [ ] 数据加密测试

### 4.2 部署配置（2天）

- [ ] 生产环境部署
  - [ ] Kubernetes配置
  - [ ] 负载均衡设置
  - [ ] SSL证书配置
  - [ ] 监控告警配置
- [ ] 灾备系统配置
  - [ ] 备份恢复测试
  - [ ] 故障转移配置
  - [ ] 数据一致性验证

### 4.3 文档完善（2天）

- [ ] 技术文档更新
  - [ ] API文档更新
  - [ ] 部署文档完善
  - [ ] 架构设计文档
- [ ] 用户文档
  - [ ] 用户操作手册
  - [ ] 常见问题解答
  - [ ] 故障排除指南

## 里程碑和时间节点

1. 第一阶段完成（2周）：基础设施就绪

   - ✅ 开发环境可用
   - ✅ 数据库系统可用
   - ✅ 监控系统运行

2. 第二阶段完成（5周）：核心服务可用

   - [ ] 所有微服务运行
   - [ ] 服务间通信正常
   - [ ] 基本功能可用

3. 第三阶段完成（7周）：系统可用

   - [ ] 前端界面完成
   - [ ] 全部功能可用
   - [ ] 性能达标

4. 第四阶段完成（8周）：正式上线
   - [ ] 全部测试通过
   - [ ] 生产环境就绪
   - [ ] 文档完善

## 风险管理

### 技术风险

- Solana RPC节点稳定性
- 数据库性能和扩展性
- 实时数据处理延迟

### 应对策略

- 多RPC节点备份
- 数据库分片和读写分离
- 缓存优化和任务队列

## 质量保证

### 测试覆盖

- 单元测试覆盖率 > 80%
- 集成测试覆盖关键路径
- 性能测试达标

### 监控指标

- 服务可用性 > 99.9%
- API响应时间 < 1s
- 错误率 < 0.1%

## 注意事项

### 安全性

- 所有代码必须遵循严格的安全协议
- 实施多层验证机制
- 定期进行安全审计
- 确保密钥管理的安全性

### 性能

- 优化 Solana 性能要求
- 实施高效的缓存策略
- 最小化 RPC 调用
- 在可能的情况下批量操作

### 可靠性

- 实施全面的错误处理
- 创建健壮的恢复机制
- 建立详细的日志系统
- 设置自动监控和警报

### 可扩展性

- 设计支持水平扩展
- 实施适当的数据库分片
- 创建高效的缓存层
- 建立负载均衡系统

## 每日工作流程

1. 代码审查和同步（每日）
2. 进度更新和调整（每周）
3. 安全审查（每周）
4. 性能监控和优化（持续）

## 沟通机制

1. 代码变更：通过 GitHub PR
2. 问题追踪：使用 GitHub Issues
3. 文档更新：实时更新本任务文档
4. 紧急情况：建立紧急联系机制

## 开发优先级建议

### 优先级1（必须）
- 安全基础设施
- 核心数据服务
- Agent状态管理
- 交易执行系统
- 风控基础功能

### 优先级2（重要）
- 评分系统
- 用户界面核心功能
- 监控告警
- 回测系统
- 数据备份

### 优先级3（完善）
- 高级分析功能
- 性能优化
- 高级用户界面
- 扩展集成

## 并行开发建议

某些模块可以并行开发以提高效率：

- **前端UI组件**可以与后端模块同时开发
- **数据模块**和**Agent管理模块**可以并行开发
- **计算模块**可以在交易模块基本完成后并行开发

