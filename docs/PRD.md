# LiqPro 产品需求文档 (PRD)

##产品整体架构
┌────────────────────────────────────┐
│           单体后端服务             │
│ ┌──────────────┐ ┌───────────────┐ │
│ │ 数据与监控   │ │ 信号与风控    │ │
│ │   模块      │ │   模块        │ │
│ └──────┬───────┘ └───────┬───────┘ │
│        │                 │         │
│        ▼                 ▼         │
│ ┌────────────────────────────────┐ │
│ │        Agent执行模块           │ │
│ └────────────────┬───────────────┘ │
│                  │                 │
│ ┌────────────────▼───────────────┐ │
│ │           REST API层           │ │
│ └────────────────┬───────────────┘ │
└──────────────────┼─────────────────┘
                   │
┌──────────────────▼─────────────────┐
│         React前端应用              │
│ ┌──────────────┐ ┌───────────────┐ │
│ │  用户界面    │ │  状态管理     │ │
│ │  组件        │ │  (Redux/Context)│ │
│ └──────────────┘ └───────────────┘ │
│ ┌────────────────────────────────┐ │
│ │       API通信层                │ │
│ └────────────────────────────────┘ │
└────────────────────────────────────┘

后端架构设计
1. 数据与监控模块
核心职责:
* Metaora Dlmm池子数据获取，5min一次,减少外部API调用
* 仓位池子详细数据获取，监控池子内流动性的分布变化，监控 "bin" 使用情况和流动性集中度，监控大户行为,5min一次,减少外部API调用
* 管理数据缓存，减少外部API调用
2. 信号与风控模块
核心职责:
* 基于Dlmm池子数据排序池子
* 生成T1/T2/T3投资推荐
* 评估现有仓位风险并决定是否触发风控,生成警报
3. Agent执行模块
核心职责:
* 管理用户钱包和资金
* 根据信号和警报，执行LP添加/移除操作
* 处理代币兑换
* 跟踪Agent状态和收益
4. REST API层
核心职责:
* 提供统一的外部接口
* 处理认证和授权
* 实现基本的请求验证
* 格式化响应数据
主要API端点设计:
1. 认证API
   * POST /api/auth/connect - 钱包连接请求，生成待签名的欢迎消息
   * POST /api/auth/verify - 验证钱包签名并返回访问令牌
   * GET /api/auth/nonce - 获取新的随机数(用于签名刷新)
2. 池子数据API
   * GET /api/pools/recommended - 获取推荐池子
3. Agent管理API
   * GET /api/agents - 获取用户的所有Agent
   * POST /api/agents - 创建新Agent
   * GET /api/agents/:id - 获取特定Agent详情
   * POST /api/agents/:id/fund - 向Agent注入资金
   * POST /api/agents/:id/withdraw - 从Agent提取资金
   * POST /api/agents/:id/start - 启动Agent
   * POST /api/agents/:id/stop - 停止Agent
4. 仓位管理API
   * GET /api/agents/:id/positions - 获取Agent当前仓位
   * POST /api/agents/:id/positions - 手动添加仓位
   * DELETE /api/agents/:id/positions/:positionId - 移除特定仓位
前端架构设计
1. 用户界面组件
核心组件:
1. 登录/注册页面
   * 简洁的用户身份验证界面
2. Dashboard概览
   * 用户资产总览
   * Agent列表卡片
   * 创建Agent入口
3. Agent详情页
   * Agent状态显示(运行中/已停止)
   * 资金注入/提取控制
   * 仓位列表与健康度指示器
   * 收益统计与图表
   * 操作日志区域
4. 池子推荐区
   * 展示T1/T2推荐池子
   * 池子详细信息卡片
   * 手动LP操作选项
5. 智能辅助面板
   * Agent"思考过程"展示
   * 简化的市场分析提示
   * 风控警告通知
2. 状态管理
采用轻量级方案:
* 使用React Context API管理全局状态
* 避免引入Redux等复杂状态管理库
* 按功能区域划分Context(认证、Agent、池子数据)
3. API通信层
简化的API调用封装:
* 使用Axios创建API客户端
* 统一处理认证令牌
* 实现基本错误处理和重试逻辑
数据流设计
主要数据流路径:
1. 池子数据流 Meteora API → 数据与监控模块 → 信号与风控模块 → API层 → 前端展示
2. 
3. 用户操作流 前端操作 → API层 → Agent执行模块 → 区块链 → 更新前端状态
4. 
5. 风控流程 数据与监控模块 → 信号与风控模块(触发风控) → Agent执行模块(执行清仓) → API层 → 前端通知
6. 
开发与部署简化策略
简化开发:
1. 统一技术栈
   * 后端: Node.js + Express
   * 前端: React + Context API
   * 共享: TypeScript类型定义
2. 最小化依赖
   * 使用内存缓存替代Redis
   * 轻量级ORM或直接SQL替代复杂ORM
   * 使用JWT简化认证
3. 渐进式开发
   * 首先实现基础Agent功能和UI
   * 然后添加自动化功能
   * 最后增强监控和风控能力
简化部署:
1. 单体应用部署
   * 后端和前端打包为单一Docker镜像
   * 后端服务静态提供前端文件
2. 最小基础设施
   * 单一数据库实例(PostgreSQL)
   * 无需消息队列或缓存服务
   * 可选的S3兼容存储(日志和备份)
用户体验设计要点
1. 简洁的用户旅程
   * 登录 → 创建Agent → 注入资金 → 启动 → 监控收益
   * 每步有清晰指引和反馈
2. 直观的风险可视化
   * 使用色彩编码显示健康度(绿色-黄色-红色)
   * 简单仪表盘展示关键指标
   * 风险警告以醒目方式呈现
3. 智能Agent形象
   * 通过简化的"思考日志"展示Agent智能形象
   * 使用简单动画强化自动化感受
   * 实时反馈Agent的操作和决策
总结
这种轻量级、高度耦合的架构设计专为最小化开发成本而优化，同时保留了产品的核心功能和良好用户体验。通过将系统组织为三个主要后端模块和一个统一的前端应用，我们可以实现快速开发和部署，同时保持足够的灵活性以支持未来的功能扩展。
该架构特别适合MVP(最小可行产品)阶段，可以快速验证产品概念并收集用户反馈，为后续迭代提供基础。随着用户基础的增长和需求的变化，可以有选择地扩展特定模块或增加新功能，而不需要彻底重构整个系统。

